<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚ªã‚»ãƒ­ (HTML/CSS/JS)</title>
<style>
    body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background:#2e7d32;
        color:#fff;
        text-align:center;
        margin:0;
        padding:20px;
    }
    h1 {margin-bottom:5px;}
    #score {font-size:1.2rem; margin:10px 0;}
    #board {
        display:grid;
        grid-template-columns: repeat(8, 50px);
        grid-template-rows   : repeat(8, 50px);
        gap:2px;
        justify-content:center;
        background:#006400;
        padding:4px;
        border-radius:6px;
    }
    .cell {
        width:50px; height:50px;
        background:#009688;
        position:relative;
        cursor:pointer;
    }
    .cell.invalid {cursor:not-allowed;}
    .disc {
        width:40px; height:40px;
        border-radius:50%;
        position:absolute;
        top:5px; left:5px;
    }
    .black  {background:#000;}
    .white  {background:#fff;}
    #resetBtn{
        margin-top:15px;
        padding:8px 16px;
        font-size:1rem;
        background:#ff9800;
        border:none;
        border-radius:4px;
        cursor:pointer;
    }
</style>
</head>
<body>

<h1>ã‚ªã‚»ãƒ­ (å¯¾CPU)</h1>
<div id="score">é»’: 2 | ç™½: 2</div>
<div id="board"></div>
<button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>

<script>
// ---------------------- å®šæ•°ãƒ»å¤‰æ•° ----------------------
const SIZE = 8;
const EMPTY = 0, BLACK = 1, WHITE = -1;   // é»’ï¼ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€ç™½ï¼CPU
let board = [];          // 2æ¬¡å…ƒé…åˆ— (SIZE x SIZE)
let currentPlayer = BLACK; // æ‰‹ç•ªï¼ˆæœ€åˆã¯é»’ï¼äººé–“ï¼‰

// ---------------------- åˆæœŸåŒ– ----------------------
function initBoard() {
    board = Array.from({length: SIZE}, () => Array(SIZE).fill(EMPTY));
    const mid = SIZE/2;
    board[mid-1][mid-1] = WHITE;
    board[mid][mid]     = WHITE;
    board[mid-1][mid]   = BLACK;
    board[mid][mid-1]   = BLACK;
    currentPlayer = BLACK;
    render();
}
document.getElementById('resetBtn').addEventListener('click', initBoard);

// ---------------------- ç›¤é¢æç”» ----------------------
function render() {
    const boardDiv = document.getElementById('board');
    boardDiv.innerHTML = '';
    for (let y=0; y<SIZE; y++) {
        for (let x=0; x<SIZE; x++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            // ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ã¯é»’(ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼)ã®æ‰‹ç•ªã ã‘æœ‰åŠ¹
            if (currentPlayer === BLACK && board[y][x]===EMPTY && canPlace(x,y,BLACK).length>0){
                cell.addEventListener('click', ()=>humanTurn(x,y));
            } else {
                cell.classList.add('invalid');
            }

            // é§’ãŒã‚ã‚‹å ´åˆã¯æç”»
            if (board[y][x] !== EMPTY) {
                const disc = document.createElement('div');
                disc.className = 'disc ' + (board[y][x]===BLACK?'black':'white');
                cell.appendChild(disc);
            }
            boardDiv.appendChild(cell);
        }
    }
    updateScore();
}

// ---------------------- ã‚¹ã‚³ã‚¢è¡¨ç¤º ----------------------
function updateScore(){
    let black=0, white=0;
    for(let row of board){
        for(let v of row){
            if(v===BLACK) black++;
            else if(v===WHITE) white++;
        }
    }
    document.getElementById('score').textContent = `é»’: ${black} | ç™½: ${white}`;
}

// ---------------------- æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ« ----------------------
const dirs = [
    [0,1],[1,0],[0,-1],[-1,0],
    [1,1],[1,-1],[-1,1],[-1,-1]
];

// ---------------------- æ‰‹ãŒç½®ã‘ã‚‹ã‹åˆ¤å®š & è£è¿”ã™åº§æ¨™å–å¾— ----------------------
function canPlace(x,y,color){
    if(board[y][x] !== EMPTY) return [];
    const toFlip = [];

    for(const [dx,dy] of dirs){
        let nx=x+dx, ny=y+dy;
        const line=[];
        while(nx>=0 && nx<SIZE && ny>=0 && ny<SIZE && board[ny][nx]===-color){
            line.push([nx,ny]);
            nx+=dx; ny+=dy;
        }
        if(line.length>0 && nx>=0 && nx<SIZE && ny>=0 && ny<SIZE && board[ny][nx]===color){
            toFlip.push(...line);
        }
    }
    return toFlip;
}

// ---------------------- äººé–“ã®æ‰‹ç•ª ----------------------
function humanTurn(x,y){
    const flips = canPlace(x,y,BLACK);
    if(flips.length===0) return; // ä¸æ­£æ‰‹ã¯ç„¡è¦–
    board[y][x] = BLACK;
    for(const [fx,fy] of flips) board[fy][fx]=BLACK;
    currentPlayer = WHITE;
    render();
    setTimeout(cpuTurn, 300); // å°‘ã—å¾…ã£ã¦ã‹ã‚‰CPUã¸
}

// ---------------------- CPU ã®æ‰‹ç•ªï¼ˆç°¡æ˜“AIï¼‰ ----------------------
function cpuTurn(){
    const moves = [];
    for(let y=0; y<SIZE; y++){
        for(let x=0; x<SIZE; x++){
            const flips = canPlace(x,y,WHITE);
            if(flips.length>0){
                moves.push({x,y,flips});
            }
        }
    }

    // æ‰‹ãŒç„¡ã„å ´åˆã¯ãƒ‘ã‚¹
    if(moves.length===0){
        currentPlayer = BLACK;
        render();
        checkGameEnd();
        return;
    }

    // ã‚‚ã£ã¨ã‚‚å¤šãè£è¿”ã›ã‚‹æ‰‹ã‚’é¸æŠï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªè©•ä¾¡é–¢æ•°ï¼‰
    moves.sort((a,b)=>b.flips.length - a.flips.length);
    const best = moves[0];

    board[best.y][best.x] = WHITE;
    for(const [fx,fy] of best.flips) board[fy][fx]=WHITE;

    currentPlayer = BLACK;
    render();
    // äººé–“ãŒç½®ã‘ãªã„å ´åˆã¯å†åº¦CPUã‚¿ãƒ¼ãƒ³ã¸
    if(!hasLegalMove(BLACK)){
        setTimeout(cpuTurn, 300);
    } else {
        checkGameEnd();
    }
}

// ---------------------- æ‰‹ç•ªãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ ----------------------
function hasLegalMove(color){
    for(let y=0; y<SIZE; y++){
        for(let x=0; x<SIZE; x++){
            if(canPlace(x,y,color).length>0) return true;
        }
    }
    return false;
}

// ---------------------- çµ‚äº†åˆ¤å®š ----------------------
function checkGameEnd(){
    const blackCan = hasLegalMove(BLACK);
    const whiteCan = hasLegalMove(WHITE);
    if(!blackCan && !whiteCan){
        // ä¸¡è€…ã¨ã‚‚ç½®ã‘ãªã„ â†’ ã‚²ãƒ¼ãƒ çµ‚äº†
        let black=0, white=0;
        for(let row of board){
            for(let v of row){
                if(v===BLACK) black++;
                else if(v===WHITE) white++;
            }
        }
        let msg = `ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ é»’ ${black} - ç™½ ${white}\n`;
        if(black>white) msg += 'ã‚ãªãŸã®å‹ã¡ã§ã™ ğŸ‰';
        else if(black<white) msg += 'CPU ã®å‹ã¡ã§ã™ ğŸ˜¢';
        else msg += 'å¼•ãåˆ†ã‘ã§ã™ ğŸ¤';
        alert(msg);
    }
}

// ---------------------- èµ·å‹• ----------------------
initBoard();
</script>

</body>
</html>
